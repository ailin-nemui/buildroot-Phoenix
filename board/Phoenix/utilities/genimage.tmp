image overlayfs.ext4 {
	ext4 {
		use-mke2fs = "true"
		label = "overlayfs"
	}
	empty = "true"
	size = 2G
}

image Phoenix.img {
	name = "Phoenix-${GENIMAGE_BUILD_ID}"
	hdimage {
		gpt = "true"
	}

	partition state {
		offset = 0x14400
		size = 0x30000
		image = "/dev/null"
		in-partition-table = "no"
	}

	partition barebox-environment {
		size = 64K
		image = "/dev/null"
	}

	partition ssbl {
		image = "barebox.bin"
	}

	partition PrimaryRootfs {
		image = "rootfs.ext4"
	}

	partition SecondaryRootfs {
		image = "rootfs.ext4"
	}

	partition overlayfs {
		image = "overlayfs.ext4"
	}
}

image bundle-Phoenix.${GENIMAGE_BUILD_ID}.raucb {
	name = "bundle-Phoenix-${GENIMAGE_BUILD_ID}"
	rauc {
		files = {
			"rootfs.tar.xz"
		}
		key = "${BR2_EXTERNAL_PHOENIX_PATH}/certs/signing.key"
		cert = "${BR2_EXTERNAL_PHOENIX_PATH}/certs/signing.crt"
		extraargs = "--keyring ${BR2_EXTERNAL_PHOENIX_PATH}/certs/keyring.pem"
		manifest = 
			"[update]
			compatible=Phoenix
			version=${GENIMAGE_BUILD_ID}
			description=RAUC bundle for Phoenix version ${GENIMAGE_BUILD_ID}, built by ${GENIMAGE_USER}@${GENIMAGE_HOST}.
			[image.rootfs]
			filename=rootfs.tar.xz"
	}
}
